---
import { metrics } from '@/site-config'
---

<div class='grid grid-cols-1 gap-3 rounded-xl border p-2 sm:grid-cols-2 sm:p-3' id='widget'>
  加载中...
</div>

<script is:inline type='module' data-astro-rerun define:vars={{ metrics: metrics }}>
  if (metrics.enable && metrics.widget) {
    fetch(metrics.widget)
      .then((res) => res.text())
      .then((data) => {
        let num = data.match(/(<\/span><span>).*?(\/span><\/p>)/g)
        if (!num) {
          console.warn('51.la 数据匹配失败')
          return
        }
        num = num.map((el) => el.replace(/(<\/span><span>|<\/span><\/p>)/g, ''))
        const titles = [
          '最近活跃',
          '今日人数',
          '今日访问',
          '昨日人数',
          '昨日访问',
          '本月访问',
          '总访问量'
        ]
        const container = document.getElementById('widget')
        let html = ''
        for (let i = 0; i < num.length; i++) {
          if (i === 0) continue
          html += `<div class='group text-muted-foreground no-underline cursor-pointer'>`
          html += `<div class='flex items-center gap-3 rounded-lg border border-transparent px-3 py-2 transition-all hover:border-border hover:bg-muted'>`
          html += `<div class='flex-1 text-foreground transition-colors group-hover:text-primary'>${titles[i]}</div>`
          html += `<div class='flex items-center gap-1.5'><samp>${num[i]}</samp></div>`
          html += `</div>`
          html += `</div>`
        }
        container.innerHTML = html
      })
      .catch((err) => {
        console.error('51.la 数据获取失败:', err)
        document.getElementById('widget').innerHTML = '加载失败'
      })
  }
</script>

<div class='mt-2 text-right text-sm'>
  Display real-time; powered by <a
    class='text-muted-foreground'
    href='https://www.51.la'
    target='_blank'
    rel='noopener noreferrer'>51.la</a
  >
</div>
