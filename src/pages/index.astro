---
import { Image } from 'astro:assets'

import { getBlogCollection, sortMDByDate } from 'astro-pure/server'
import { Button, FormattedDate, Icon, Label } from 'astro-pure/user'
import PageLayout from '@/layouts/BaseLayout.astro'
import Section from '@/components/home/Section.astro'
import SkillLayout from '@/components/home/SkillLayout.astro'
import ProductDelivery from '@/components/projects/ProductDelivery.astro'
import ProblemSimplify from '@/components/vue/ProblemSimplify.vue'
import config from '@/site-config'

const languages = ['Html', 'JavaScript', 'CSS', 'Vue', 'Shell', 'PHP', 'Go', 'Python', 'SQL', 'Git']
const frontend = ['TypeScript', 'Vite', 'Naive UI', 'Vant', 'Element']
const backend = ['Gin', 'ThinkPHP', 'Laravel', 'Webman']

const MAX_POSTS = 6
const allPosts = await getBlogCollection()
const allPostsByDate = sortMDByDate(allPosts).slice(0, MAX_POSTS)

const imagePath = config.logo.src
const images = import.meta.glob<{ default: ImageMetadata }>(
  '/src/assets/*.{jpeg,jpg,png,gif,avif,webp}'
)
if (!images[imagePath])
  throw new Error(
    `"${imagePath}" does not exist in glob: "src/assets/*.{jpeg,jpg,png,gif,avif,webp}"`
  )
---

<PageLayout meta={{ title: '首页' }} highlightColor='#5EA88A'>
  <main class='flex w-full flex-col items-center'>
    <section class='w-full flex flex-col gap-6'>
      <div
        class='rounded-xl border border-gray-200 dark:border-gray-700 bg-muted shadow-sm p-6 flex flex-col lg:flex-row gap-6'
      >
        <div class='lg:w-1/3 flex flex-col items-center text-center gap-4'>
          <Image
            src={images[imagePath]()}
            alt={config.logo.alt || 'Profile'}
            class='h-28 w-28 rounded-full border border-zinc-200 dark:border-zinc-700 p-1 shadow'
            loading='eager'
            fetchpriority='high'
          />
          <h2 class='text-xl font-semibold'>何俊杰</h2>
          <p class='text-sm text-gray-600 dark:text-gray-400'>PHP 工程师 / 全栈开发</p>
          <div class='flex flex-wrap justify-center gap-2 mt-2'>
            <Button
              as='a'
              href='https://github.com/zxc7563598'
              title='Github'
              variant='ahead'
              class='not-prose'
            />
            <Button
              as='a'
              href='/projects#direct-contact'
              title='联系我'
              variant='ahead'
              class='not-prose'
            />
            <Button as='a' href='/problem' title='向我提问' variant='ahead' class='not-prose' />
          </div>
        </div>
        <div
          class='lg:w-2/3 flex flex-col justify-center text-gray-700 dark:text-gray-300 leading-relaxed'
        >
          <p>一名独立开发者，主要使用 Go 与 PHP 构建后端服务，也会用 Vue 写一点前端。</p>
          <p class='mt-3'>我喜欢把想法变成可以跑起来的代码，也喜欢研究系统背后的逻辑与工程细节。</p>
          <p class='mt-3'>
            这个博客记录的是我在开发过程中的经验、坑点和一些思考。希望这些内容能帮到你，也欢迎交流。
          </p>
          <p class='mt-3'>
            如果你正在寻找一位技术合作者、远程开发者，或者只是想做一些技术咨询，都可以随时联系我，交流总比独自摸索要有趣得多。
          </p>
          <Button title='更多关于我' class='w-fit self-end mt-3' href='/about' variant='ahead' />
        </div>
      </div>
    </section>

    <div id='content' class='animate flex flex-col gap-y-10 w-full'>
      <section class='w-full mt-10'>
        <div class='flex flex-col lg:flex-row w-full gap-4'>
          <div class='w-full lg:w-3/5'>
            <div class='border-b-primary pb-2 mb-2 flex'>
              <span class='text-xl font-semibold'>最近文章</span>
              <Button
                as='a'
                href='/blog'
                title='更多文章'
                variant='ahead'
                class='ml-a text-sm not-prose'
              />
            </div>
            <ul class='flex flex-col gap-y-3 sm:gap-y-4'>
              {
                allPostsByDate.map((p) => (
                  <li>
                    <a
                      href={`/blog/${p.id}`}
                      class='block rounded-xl border px-4 py-3 sm:px-5 sm:py-4 transition-colors hover:bg-muted dark:hover:bg-muted'
                    >
                      <h2 class='text-lg font-medium m-0'>{p.data.title}</h2>

                      <p class='mt-1 text-sm text-muted-foreground'>{p.data.description}</p>

                      <p class='mt-2 text-xs text-muted-foreground'>
                        <FormattedDate
                          class='min-w-[95px] text-xs'
                          date={p.data.publishDate ?? new Date()}
                        />
                      </p>
                    </a>
                  </li>
                ))
              }
            </ul>
          </div>
          <div class='w-full lg:w-2/5'>
            <div>
              <div class='border-b-primary pb-2 mb-2 flex'>
                <span class='text-xl font-semibold'>提问箱</span>
              </div>
              <ProblemSimplify client:load />
            </div>
            <div class="mt-4">
              <div class='border-b-primary pb-2 mb-2 flex'>
                <span class='text-xl font-semibold'>小工具</span>
              </div>
              <ProductDelivery
                list={{
                  id_name: '',
                  desc: '',
                  link_list: [
                    {
                      name: '身份证信息查询',
                      intro: '校验身份证并提取位置、性别等信息',
                      link: '/composer/china-division',
                      avatar: '/icons/china-division.png'
                    },
                    {
                      name: '手机号信息查询',
                      intro: '提取手机号运营商/归属地',
                      link: '/composer/mobile-locator',
                      avatar: '/icons/mobile-locator.png'
                    },
                    {
                      name: '地址解析工具',
                      intro: '从非结构化的地址文本中提取结构化信息',
                      link: '/composer/address-parser',
                      avatar: '/icons/address-parser.png'
                    },
                    {
                      name: '八字排盘',
                      intro: '阴阳历转换节气查询，四柱排盘五行推演',
                      link: '/composer/fortune-analyzer',
                      avatar: '/icons/fortune-analyzer.png'
                    },
                    {
                      name: '随机头像生成',
                      intro: '根据唯一标识生成专属头像',
                      link: '/projects/item/avatar-service',
                      avatar: '/icons/avatar.png'
                    }
                  ]
                }}
              />
            </div>
          </div>
        </div>
      </section>

      <Section title='技能'>
        <SkillLayout title='语言' skills={languages} />
        <SkillLayout title='前端' skills={frontend} />
        <SkillLayout title='后端' skills={backend} />
      </Section>
    </div>
  </main>
</PageLayout>
