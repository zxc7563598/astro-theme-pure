---
title: 'MySQL å¤‡ä»½ Shell è„šæœ¬ï¼šæ”¯æŒè¿œç¨‹åŒæ­¥ä¸é˜¿é‡Œäº‘ OSS å¤‡ä»½'
publishDate: '2025-03-31 13:31:27'
description: 'ä¸€æ¬¾è‡ªåŠ¨åŒ– MySQL å¤‡ä»½ Shell è„šæœ¬ï¼Œæ”¯æŒæœ¬åœ°å­˜å‚¨ã€è¿œç¨‹æœåŠ¡å™¨åŒæ­¥ï¼ˆSSH+rsyncï¼‰ã€é˜¿é‡Œäº‘ OSS å¤‡ä»½ï¼Œå¹¶è‡ªåŠ¨æ¸…ç†è¿‡æœŸå¤‡ä»½ã€‚é€‚ç”¨äºæ•°æ®åº“ç®¡ç†å‘˜å’Œå¼€å‘è€…ï¼Œå¸®åŠ©ç¡®ä¿æ•°æ®å®‰å…¨'
tags:
  - Shell
  - MySQL
language: 'ä¸­æ–‡'
heroImage: { src: './cover/mysql.png', color: '#01618d' }
draft: false
slug: '758d8d3'
---

ä¹‹å‰æˆ‘å†™è¿‡ä¸€ä¸ªä¸´æ—¶çš„ MySQL å¤‡ä»½è„šæœ¬ï¼Œä¸»è¦æ˜¯ä¸ºäº†åº”æ€¥ä½¿ç”¨ï¼ŒåŠŸèƒ½æ¯”è¾ƒç®€å•ã€‚ç°åœ¨æœ‰æ—¶é—´äº†ï¼Œæˆ‘é‡æ–°æ•´ç†äº†ä¸€ä¸‹ï¼Œè®©å®ƒä¸ä»…èƒ½è‡ªåŠ¨å¤‡ä»½æ•°æ®åº“ï¼Œè¿˜æ”¯æŒè¿œç¨‹æœåŠ¡å™¨åŒæ­¥å’Œä¸Šä¼ åˆ°é˜¿é‡Œäº‘ OSSï¼Œè¿™æ ·å³ä½¿æœ¬åœ°å¤‡ä»½ä¸¢å¤±ï¼Œæ•°æ®ä¹Ÿä¸ä¼šå®Œå…¨ä¸¢å¤±ã€‚

ç°åœ¨ï¼Œè¿™ä¸ªè„šæœ¬å·²ç»å‘å¸ƒåˆ° GitHubï¼Œåœ°å€åœ¨è¿™é‡Œï¼š  
ğŸ‘‰ **[GitHub ä»“åº“ - mysql-backup-shell](https://github.com/zxc7563598/mysql-backup-shell)**

---

## è¿™ä¸ªè„šæœ¬åšäº†ä»€ä¹ˆï¼Ÿ

è¿™ä¸ªè„šæœ¬çš„æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ï¼š

- **è‡ªåŠ¨å¤‡ä»½ MySQL æ•°æ®åº“**ï¼Œæ¯å¤©å®šæ—¶è¿è¡Œï¼ˆå¯é€šè¿‡ `crontab`â€‹ è®¾ç½®ï¼‰ã€‚
- **æœ¬åœ°å­˜å‚¨**ï¼šæŒ‰æ—¥æœŸåˆ†ç±»å­˜æ”¾å¤‡ä»½æ–‡ä»¶ï¼Œå¹¶è‡ªåŠ¨åˆ é™¤è¿‡æœŸå¤‡ä»½ï¼Œé¿å…ç£ç›˜å æ»¡ã€‚
- **è¿œç¨‹æœåŠ¡å™¨åŒæ­¥**ï¼šæ”¯æŒé€šè¿‡ `rsync`â€‹ ä¼ è¾“å¤‡ä»½åˆ°å¦ä¸€å°æœåŠ¡å™¨ï¼Œç¡®ä¿æ•°æ®å†—ä½™ã€‚
- **é˜¿é‡Œäº‘ OSS å¤‡ä»½**ï¼šå¯ä»¥å°†å¤‡ä»½æ–‡ä»¶ä¸Šä¼ åˆ°é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨ï¼Œè¿›ä¸€æ­¥å¢å¼ºå®‰å…¨æ€§ã€‚
- **è‡ªåŠ¨æ¸…ç†è¿‡æœŸå¤‡ä»½**ï¼šå®šæœŸæ¸…ç†æœ¬åœ°ã€è¿œç¨‹å’Œ OSS ä¸Šçš„æ—§å¤‡ä»½ï¼Œå‡å°‘å­˜å‚¨æˆæœ¬ã€‚

ä½ å¯ä»¥åœ¨ `mysql_backup.sh`â€‹ ä¸­ä¿®æ”¹é…ç½®ï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚è°ƒæ•´å¤‡ä»½ç­–ç•¥ã€‚

---

## å¦‚ä½•ä½¿ç”¨ï¼Ÿ

### 1. ä¸‹è½½è„šæœ¬

```bash
git clone https://github.com/zxc7563598/mysql-backup-shell.git
cd mysql-backup-shell
chmod +x mysql_backup.sh
```

ç„¶åä¿®æ”¹ `mysql_backup.sh`â€‹ é‡Œçš„å‚æ•°ï¼Œç¡®ä¿ `MySQL`â€‹ è¿æ¥ä¿¡æ¯æ­£ç¡®ã€‚

### 2. è®¾ç½®å®šæ—¶ä»»åŠ¡

æ‰§è¡Œ `crontab -e`â€‹ï¼Œç„¶åæ·»åŠ ï¼š

```bash
0 3 * * * /path/to/mysql_backup.sh
```

è¿™æ ·æ¯å¤©å‡Œæ™¨ 3:00 å°±ä¼šè‡ªåŠ¨æ‰§è¡Œå¤‡ä»½ã€‚

---

## è¿œç¨‹æœåŠ¡å™¨åŒæ­¥é…ç½®

å¦‚æœæƒ³æŠŠå¤‡ä»½åŒæ­¥åˆ°å¦ä¸€å°æœåŠ¡å™¨ï¼Œéœ€è¦é…ç½® SSH å…å¯†ç™»å½•ã€‚

### 1. ç”Ÿæˆ SSH å¯†é’¥

åœ¨æœ¬æœºæ‰§è¡Œï¼š

```bash
ssh-keygen -t rsa -b 4096 -f ~/.ssh/my_backup_key
```

ç„¶åæŠŠç”Ÿæˆçš„ `my_backup_key.pub`â€‹ å¤åˆ¶åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼š

```bash
ssh-copy-id -i ~/.ssh/my_backup_key.pub user@remote_server_ip
```

ä¿®æ”¹è„šæœ¬é…ç½®ï¼š

```bash
enable_ssh_sync=true  # æ˜¯å¦å¯ç”¨ SSH åŒæ­¥ï¼ˆtrue/falseï¼‰
enable_ssh_clean=true  # æ˜¯å¦æ¸…ç†è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„å¤‡ä»½ï¼ˆtrue/falseï¼‰
ssh_ip="182.22.13.33"  # è¿œç¨‹æœåŠ¡å™¨ IP
ssh_port=22  # SSH ç«¯å£
ssh_user="root"  # ç™»å½•è¿œç¨‹æœåŠ¡å™¨çš„ç”¨æˆ·å
clientPath="/home/backup/mysql/"  # è¿œç¨‹æœåŠ¡å™¨å­˜å‚¨è·¯å¾„
```

é…ç½®å®Œæˆåï¼Œè„šæœ¬è¿è¡Œæ—¶å°±èƒ½æŠŠå¤‡ä»½åŒæ­¥åˆ°è¿œç¨‹æœåŠ¡å™¨äº†ã€‚

---

## é˜¿é‡Œäº‘ OSS å¤‡ä»½é…ç½®

### 1. å®‰è£… `ossutil`â€‹

éœ€è¦å®‰è£… ossutilï¼Œé˜¿é‡Œäº‘æœ‰ååˆ†å®Œå–„çš„æ–‡æ¡£ï¼Œç‚¹å‡»æŸ¥çœ‹ï¼š[å®‰è£… ossutil](https://help.aliyun.com/zh/oss/developer-reference/install-ossutil2)

> ä»…éœ€å®Œæˆå®˜æ–¹æ–‡æ¡£ä¸­çš„ç¬¬ä¸€æ­¥å®‰è£… ossutil ä½¿å…¶å‘½ä»¤å¯ç”¨å³å¯ï¼Œä¸éœ€è¦æ‰§è¡Œå®˜æ–¹æ–‡æ¡£ä¸­çš„ `ossutil config`â€‹ å¯¹ ossutil è¿›è¡Œé…ç½®

### 2. åˆ›å»º Bucket

è¿›å…¥ [å¯¹è±¡å­˜å‚¨ OSS - Bucket åˆ—è¡¨](https://oss.console.aliyun.com/bucket)ï¼Œåˆ›å»º Bucketï¼Œç”¨äºå­˜æ”¾æ•°æ®åº“å¤‡ä»½æ–‡ä»¶

### 3. è·å–é˜¿é‡Œäº‘ AccessKey

è¿›å…¥ [é˜¿é‡Œäº‘ AccessKey ç®¡ç†](https://ram.console.aliyun.com/profile/access-keys)ï¼Œåˆ›å»º AccessKey å¹¶è®°å½• `AccessKey ID`â€‹ å’Œ `AccessKey Secret`â€‹ã€‚

### 3. ä¿®æ”¹è„šæœ¬é…ç½®

```bash
enable_oss_upload=true  # æ˜¯å¦å¯ç”¨ OSS ä¸Šä¼ ï¼ˆtrue/falseï¼‰
enable_oss_clean=true  # æ˜¯å¦æ¸…ç†é˜¿é‡Œäº‘ OSS ä¸Šçš„å¤‡ä»½ï¼ˆtrue/falseï¼‰
oss_bucket="oss://Bucketåç§°/æƒ³å­˜å‚¨çš„æ–‡ä»¶å¤¹è·¯å¾„/"  # OSS ç›®æ ‡è·¯å¾„
oss_access_key="your-access-key-id"  # é˜¿é‡Œäº‘ AccessKey
oss_secret_key="your-access-key-secret"  # é˜¿é‡Œäº‘ Secret
oss_endpoint="oss-cn-hangzhou.aliyuncs.com"  # OSS è®¿é—®åœ°å€ï¼Œåœ¨å¯¹åº” bucket çš„æ¦‚è§ˆä¸­å¯ä»¥çœ‹åˆ°å¤–ç½‘è®¿é—®çš„ Endpoint
```

é…ç½®å®Œæˆåï¼Œè„šæœ¬è¿è¡Œæ—¶å¤‡ä»½æ–‡ä»¶å°±ä¼šè‡ªåŠ¨ä¸Šä¼ åˆ° OSS äº†ã€‚

---

## ç»“è¯­

è¿™ä¸ªè„šæœ¬èƒ½å¸®åŠ©ä½ è½»æ¾ç®¡ç† MySQL å¤‡ä»½ï¼Œæ”¯æŒæœ¬åœ°å­˜å‚¨ã€è¿œç¨‹åŒæ­¥å’Œé˜¿é‡Œäº‘ OSS å¤‡ä»½ã€‚å¦‚æœä½ ä¹Ÿéœ€è¦å®šæœŸå¤‡ä»½æ•°æ®åº“ï¼Œå¯ä»¥è¯•è¯•è¿™ä¸ªä»“åº“ï¼š

ğŸ‘‰ **[GitHub ä»“åº“ - mysql-backup-shell](https://github.com/zxc7563598/mysql-backup-shell)** ğŸš€

å¦‚æœæœ‰ä»»ä½•é—®é¢˜æˆ–æ”¹è¿›å»ºè®®ï¼Œæ¬¢è¿æ Issue æˆ– Fork è¿›è¡Œä¼˜åŒ–ï¼
