---
title: '记录一次对CC攻击的处理'
publishDate: '2024-10-08 12:47:32'
description: '本文讲述了一次遭遇CC攻击的真实经历以及部分有效解决方案'
tags:
  - Web
language: '中文'
heroImage: { src: './cover/web.jpg', color: '#3594ec' }
draft: false
slug: '202f6e55'
---

最近，我的 PHP 系统遭遇了一次 CC 攻击。这次攻击并不算特别猛烈，但足以对服务器造成明显的压力。由于从本质上来说，**CC 攻击**和**DDoS 攻击**都属于流量型和资源耗尽型的攻击，完全防御它们是不太现实的，尤其是在攻击量足够大的情况下。因此，结合这次的实际情况，系统做了一些调整和优化，以下是我尝试有效的几种应对策略。

## 使用阿里云全站加速（DCDN）

现在叫边缘安全加速（ESA）。

这是一个非常经济实惠的解决方案，在加速访问的同时，CDN 还能帮助隐藏服务器的真实 IP 地址

这对于防止 DDoS 攻击非常重要。因为 DDoS 攻击大多数是基于 IP 地址进行的，一旦服务器的 IP 地址暴露，就很容易成为攻击目标。

而通过 CDN，攻击者只能找到 CDN 节点，攻击者获取不到源服务器的 IP。这有效减轻了 DDoS 攻击的可能性，让系统能够专注于应对应用层面的 CC 攻击。

## 阿里云的 WAF（Web 应用防火墙）

WAF 的核心功能就是在请求到达服务器之前进行一次安全检查，从而过滤掉明显的恶意请求。

区域封禁+限速器组合使用，一方面可以封禁非业务地区（例如不存在海外业务时候无需处理来自境外的请求），一方面可以过滤掉明显异常的高频请求。

这一步非常关键，因为 CC 攻击的目的是消耗服务器资源，一旦服务器资源被耗尽，整个系统就会陷入瘫痪。而 WAF 能够在流量进入服务器之前过滤掉这些恶意流量，从源头上减少服务器的压力。

## 使用 Webman 等高性能框架

除了外部的防护措施，高性能框架也是应对攻击的关键。在这次攻击处理中，我使用了 Webman 框架，这是一种常驻内存的 PHP 高性能框架。

相比传统依靠 FPM（FastCGI Process Manager），每个请求都会重新加载应用程序和 PHP 环境，的框架

Webman 使用了常驻内存模型，意味着 PHP 和框架只会在服务器启动时加载一次，之后的每个请求直接使用已经加载的内存，性能极高，可以显著提高每秒请求处理能力（QPS），使得服务器能在同等资源下承受更多的请求。

Webman 在这次攻击中表现非常出色，在高并发下保持了较高的响应速度。即使是在遭遇 CC 攻击的情况下，服务器也没有完全被压垮，保证了部分正常用户的访问。

## 加密与鉴权机制

在接口设计上，我建议对所有请求都要做严格的加密与鉴权处理。这样即使攻击者发起了模拟请求，只要没有通过鉴权，他们就无法真正调用到系统的核心逻辑。

通常推荐在加密数据中加入时间戳，这样每个请求都是一次性的。

一方面可以防止因抓包重复请求消耗服务器资源的情况发生。

另一方面因为时间的变化，即使是相同的内容在进行对称加密时每次的加密信息也不同，这可以有效增加加密信息被破解的难度。

只有验证通过的请求才会被进一步处理。这个设计大大降低了恶意请求对系统的影响。

## 核心防护思路

经过这次攻击处理，我总结出一个核心思路：尽量不要让恶意请求真正触发服务器资源的消耗。能在外部拦住的请求就尽量在外部拦截，无法拦住的请求则依赖系统内部的鉴权与加密机制进行二次过滤。

具体来说，通过 CDN 隐藏 IP，利用 WAF 过滤恶意流量，在应用层面通过高性能框架提高系统抗压能力，再配合加密和鉴权机制来阻止模拟请求成功，这些措施都可以有效减少 CC 攻击对服务器的影响。

## 总结

在面对 CC 攻击时，我们不可能做到百分之百的防御，尤其是当攻击量足够大时。但通过合理的防护手段，我们可以有效减少攻击带来的影响，保护系统的稳定运行。

我相信只要合理利用这些工具，并根据业务需求做出相应的调整，任何开发者都可以在遭遇攻击时尽量减少损失。
